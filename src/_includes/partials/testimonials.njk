{% macro stars(n) -%}
  <span aria-label="{{ n }} out of 5 stars" title="{{ n }} / 5">
    {% for i in [1,2,3,4,5] %}
      {% if i <= n %}★{% else %}☆{% endif %}
    {% endfor %}
  </span>
{%- endmacro %}

<section class="not-prose mt-8" aria-labelledby="testimonials-heading">
  <details class="group border rounded-lg bg-white dark:bg-gray-900 border-red-200/60 dark:border-red-900/40">
    <summary class="flex items-center justify-between cursor-pointer list-none px-4 py-3">
      <h2 id="testimonials-heading" class="text-xl font-semibold">Testimonials</h2>
      <span class="text-sm text-gray-600 dark:text-gray-400">{{ (testimonials | default([])).length }} total ▾</span>
    </summary>
  <ul class="grid gap-4 md:grid-cols-2 px-4 pb-4">
    {% for t in testimonials | default([]) %}
      <li class="p-4 rounded border bg-white dark:bg-gray-900 flex flex-col items-center text-center gap-3">
        {% if t.profile_picture %}
          <img src="{{ t.profile_picture }}" alt="Photo of {{ t.name }}" class="w-16 h-16 md:w-20 md:h-20 object-cover rounded-md mx-auto" loading="lazy" />
        {% endif %}
        <div class="w-full">
          <p class="text-sm text-gray-600 dark:text-gray-400">{{ stars(t.stars | default(5)) }}</p>
          <blockquote class="mt-1 text-gray-900 dark:text-gray-100">{{ t.comment }}</blockquote>
          <p class="mt-2 text-sm text-gray-600 dark:text-gray-400">— <span class="font-medium">{{ t.name }}</span>{% if t.time %} · <time datetime="{{ t.time }}">{{ t.time }}</time>{% endif %}</p>
        </div>
      </li>
    {% endfor %}
  </ul>
  </details>
</section>
